# 投资组合回测功能 - 快速启动指南

## ✅ 实现完成

所有必需任务已完成，功能可以立即使用！

## 🚀 启动应用

### 1. 启动后端服务器

```bash
cd server
go run main.go
```

后端将在 `http://localhost:8080` 启动

### 2. 启动前端开发服务器

```bash
cd web
npm start
```

前端将在 `http://localhost:3000` 启动

## 📋 使用步骤

1. **登录系统**
   - 使用现有账户登录或注册新账户

2. **添加持仓**
   - 确保你的账户中有一些持仓数据
   - 如果没有，先在 Holdings 页面添加一些交易

3. **访问回测页面**
   - 点击左侧导航栏的 "Backtest" 链接
   - 或直接访问 `http://localhost:3000/backtest`

4. **配置回测参数**
   - 选择货币（USD 或 RMB）
   - 选择开始日期和结束日期
   - 可以使用快捷选项：1年、3年、5年
   - （可选）选择基准指数进行对比

5. **运行回测**
   - 点击"运行回测"按钮
   - 等待计算完成（通常几秒钟）

6. **查看结果**
   - 绩效指标卡片：总收益、年化收益、最大回撤、波动率、夏普比率
   - 累计收益曲线图：展示投资组合和基准的表现
   - 资产贡献度分析：了解每个资产的贡献

## 🎯 功能亮点

### 关键绩效指标
- **总收益**: 绝对收益和百分比收益
- **年化收益率**: 标准化的年度收益率
- **最大回撤**: 从峰值到谷底的最大跌幅
- **波动率**: 收益的标准差（风险指标）
- **夏普比率**: 风险调整后的收益（>1 表示良好）

### 基准对比
支持的基准指数：
- **^GSPC**: S&P 500
- **^IXIC**: NASDAQ
- **^DJI**: Dow Jones
- **000001.SS**: 上证指数
- **399001.SZ**: 深证成指

### 资产贡献度
- 查看每个资产对总收益的贡献
- 了解哪些资产表现最好/最差
- 优化未来的投资组合配置

## 🔧 技术细节

### API 端点
```
GET /api/backtest?startDate=2023-01-01&endDate=2024-01-01&currency=USD&benchmark=^GSPC
```

### 响应格式
```json
{
  "period": { "startDate": "...", "endDate": "..." },
  "currency": "USD",
  "performance": [...],
  "metrics": {
    "totalReturn": 15000,
    "totalReturnPercent": 15.0,
    "annualizedReturn": 14.5,
    "maxDrawdown": -8.5,
    "volatility": 12.3,
    "sharpeRatio": 1.18,
    "excessReturn": 3.2
  },
  "assetContributions": [...],
  "benchmark": {...}
}
```

## 📊 示例场景

### 场景 1: 评估长期表现
- 选择 5 年时间范围
- 选择 S&P 500 作为基准
- 查看你的投资组合是否跑赢市场

### 场景 2: 分析风险
- 查看最大回撤指标
- 评估波动率
- 检查夏普比率是否 > 1

### 场景 3: 优化配置
- 查看资产贡献度
- 识别表现不佳的资产
- 考虑调整投资组合权重

## ⚠️ 注意事项

1. **数据要求**: 需要有历史持仓数据才能进行回测
2. **时间限制**: 回测期间为 1 个月到 10 年
3. **计算方式**: 基于当前持仓权重，不考虑历史交易时间
4. **数据来源**: 历史价格来自 Yahoo Finance API
5. **免责声明**: 回测结果仅供参考，不构成投资建议

## 🐛 故障排除

### 问题: "no holdings found for user"
**解决**: 确保你的账户中有持仓数据

### 问题: "no historical data available"
**解决**: 某些资产可能没有足够的历史数据，尝试缩短时间范围

### 问题: 回测计算时间过长
**解决**: 
- 缩短时间范围
- 减少持仓资产数量
- 检查网络连接

## 📈 性能优化

- ✅ 历史数据缓存（5分钟）
- ✅ 前端图表数据采样（>200点自动采样）
- ✅ 并行获取多个资产的历史数据
- ✅ 响应式设计，支持移动端

## 🎉 完成状态

- ✅ 后端服务和 API
- ✅ 前端页面和组件
- ✅ 路由和导航
- ✅ 错误处理
- ✅ 性能优化
- ✅ 类型安全
- ✅ 编译通过

**功能已完全实现并可以使用！**
